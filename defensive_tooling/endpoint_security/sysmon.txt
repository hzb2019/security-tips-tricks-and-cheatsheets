
  Microsoft definition:
  "System Monitor (Sysmon) is a Windows system service and device driver that, once installed 
  on a system, remains resident across system reboots to monitor and log system activity to the 
  Windows event log. It provides detailed information about process creations, network connections, 
  and changes to file creation time. By collecting the events it generates using Windows Event 
  Collection or SIEM agents and subsequently analyzing them, you can identify malicious or anomalous 
  activity and understand how intruders and malware operate on your network."

  Sysmon events path: Applications and Services Logs/Microsoft/Windows/Sysmon/Operational


  Useful Event IDs to monitor:
    Event ID 1: Process Creation
      <RuleGroup name="" groupRelation="or">
        <ProcessCreate onmatch="exclude">
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k appmodel -p -s camsvc</CommandLine>
        </ProcessCreate>
      </RuleGroup>

    Event ID 3: Network Connection
      <RuleGroup name="" groupRelation="or">
        <NetworkConnect onmatch="include">
          <Image condition="image">nmap.exe</Image>
          <DestinationPort name="Alert,Metasploit" condition="is">4444</DestinationPort>
        </NetworkConnect>
      </RuleGroup>

    Event ID 7: Image Loaded
      <RuleGroup name="" groupRelation="or">
        <ImageLoad onmatch="include">
          <ImageLoaded condition="contains">\Temp\</ImageLoaded>
        </ImageLoad>
      </RuleGroup>

    Event ID 8: CreateRemoteThread
      <RuleGroup name="" groupRelation="or">
        <CreateRemoteThread onmatch="include">
          <StartAddress name="Alert,Cobalt Strike" condition="end with">0B80</StartAddress>
          <SourceImage condition="contains">\</SourceImage>
        </CreateRemoteThread>
      </RuleGroup>

    Event ID 11: File Created
      <RuleGroup name="" groupRelation="or">
        <FileCreate onmatch="include">
          <TargetFilename name="Alert,Ransomware" condition="contains">HELP_TO_SAVE_FILES</TargetFilename>
        </FileCreate>
      </RuleGroup> 

    Event ID 12 / 13 / 14: Registry Event
      <RuleGroup name="" groupRelation="or">
        <RegistryEvent onmatch="include">
          <TargetObject name="T1484" condition="contains">Windows\System\Scripts</TargetObject>
        </RegistryEvent>
      </RuleGroup>

    Event ID 15: FileCreateStreamHash
      <RuleGroup name="" groupRelation="or">
        <FileCreateStreamHash onmatch="include">
          <TargetFilename condition="end with">.hta</TargetFilename>
        </FileCreateStreamHash>
      </RuleGroup> 

    Event ID 22: DNS Event
      <RuleGroup name="" groupRelation="or">
        <DnsQuery onmatch="exclude">
          <QueryName condition="end with">.microsoft.com</QueryName>
        </DnsQuery>
      </RuleGroup> 

  Installing sysmon:
    Powershell: Download-SysInternalsTools C:\Sysinternals
    https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon
    https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite

  Configs:
    https://github.com/SwiftOnSecurity/sysmon-config
    https://github.com/ion-storm/sysmon-config/blob/develop/sysmonconfig-export.xml

  Running sysmon:
    Sysmon.exe -accepteula -i [CONFIGFILE]

  Sysmon event logs stored in event viewer at: Applications and Services Logs/Microsoft/Windows/Sysmon/Operational

  "Best Practices":
    Exclude > Include
      Inclusions require you to know what to expect ahead of time, while exclusions only require you 
      know how to filter normal expected activity.
    CLI gives better control
      Get-WinEvent/wevutil.exe for accessing and filtering logs
    Know your environment before implementation
      If you don't know what you're protecting, there's no way to differentiate normal from malicious activity.
    


